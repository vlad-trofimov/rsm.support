<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>RSM Support Portal</title>
    <link rel="icon" type="image/x-icon" href="https://support.rsmus.com/favicon.ico">
    <meta name="description" content="Customer Support Portal — Example implementation inspired by RSM ClientCare." />
    <style>
      :root {
        --bg: #f6f7f9;
        --card: #ffffff;
        --ink: #0f172a;
        --muted: #64748b;
        --brand: #1c97d4; /* nod to source, but distinct UI */
        --accent: #a0ce67;
        --radius: 16px;
        --shadow: 0 6px 24px rgba(15, 23, 42, 0.08);
      }
      * { box-sizing: border-box; }
      body { margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; color: var(--ink); background: var(--bg); }
      a { color: var(--brand); text-decoration: none; }
      a:hover { text-decoration: underline; }
      header { display: flex; align-items: center; justify-content: space-between; padding: 16px 24px; background: var(--card); box-shadow: var(--shadow); position: sticky; top: 0; z-index: 10; }
      .logo { font-weight: 700; letter-spacing: 0.2px; font-size: 14px; }
      .container { max-width: 1100px; margin: 0 auto; padding: 24px; }
      .grid { display: grid; gap: 24px; grid-template-columns: 1fr; }
      .card { background: var(--card); border-radius: var(--radius); box-shadow: var(--shadow); overflow: hidden; }
      .hero { display: grid; grid-template-columns: 1fr; }
      .hero-media { position: relative; aspect-ratio: 11/15; width: 100%; background: #e5e7eb; height: 180px; }
      .hero-media img { width: 100%; height: 100%; object-fit: cover; object-position: center 35%; display: block; }
      .hero-body { padding: 24px; }
      h1 { margin: 0 0 8px; font-size: clamp(24px, 3vw, 36px); }
      p.lead { margin: 0; color: var(--muted); }
      .form { padding: 20px; display: grid; gap: 12px; }
      .row { display: grid; gap: 8px; }
      label { font-weight: 600; font-size: 14px; }
      input[type="text"], input[type="password"] { padding: 12px 14px; border-radius: 12px; border: 1px solid #e2e8f0; background: #fff; font-size: 16px; }
      .actions { display: flex; gap: 12px; align-items: center; }
      button, .btn { appearance: none; border: none; background: var(--accent); color: #fff; font-weight: 700; padding: 12px 16px; border-radius: 12px; cursor: pointer; }
      button.secondary { background: var(--brand); }
      .helper { color: var(--muted); font-size: 14px; }
      .error { color: #b91c1c; background: #fee2e2; border: 1px solid #fecaca; padding: 10px 12px; border-radius: 10px; display: none; }
      .error.show { display: block; }
      .loading { display: none; font-size: 14px; color: var(--muted); }
      .loading.show { display: inline-block; }
      footer { text-align: center; margin: 48px 0 24px; color: var(--muted); font-size: 14px; }
      @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }
    </style>
  </head>
  <body>
    <header>
      <div class="logo">rsm.support</div>
    </header>

    <main class="container">
      <!-- HERO with your image on index -->
      <section class="card hero" aria-labelledby="heroTitle">
        <div class="hero-media" role="img" aria-label="Support team assisting a customer">
          <!-- Replace the src below with your own image path or URL -->
          <img id="heroImage" src="https://scontent.fsan1-1.fna.fbcdn.net/v/t39.30808-6/463617241_10233863541799850_6510542308934623691_n.jpg?_nc_cat=106&ccb=1-7&_nc_sid=cf85f3&_nc_ohc=4lQkFpNVlzMQ7kNvwG0vdcR&_nc_oc=AdnFLivy8KmjZ5nxIyUxrQMXU5NDwTybF92O-Jz-i3IjMkZR2yZEgA0HT_tcHSQPdlw&_nc_zt=23&_nc_ht=scontent.fsan1-1.fna&_nc_gid=KT2It1SUCd8aZ-eqhZ4Ddg&oh=00_AfVU6izPFZhPyF0T-T7KEPYKg0KnaKxIv2CJY4dABjhxow&oe=68B7B0A4" alt="Your brand support portal" />
        </div>
        <div class="hero-body">
          <h1 id="heroTitle">RSM Support Portal</h1>
          <p class="lead">Start a secure session with a session key</p>
        </div>
      </section>

      <section class="grid" style="margin-top:24px">
        <!-- Session Key (similar to the source page) -->
        <article class="card" aria-labelledby="sessionKeyTitle">
          <div class="form">
            <h2 id="sessionKeyTitle" style="margin:0">Session Key</h2>
            <p class="helper">Enter a support session key provided by your technician.</p>
            <div id="sessionKeyError" class="error" role="alert"></div>
            <div class="row">
              <label for="sessionKey">Session Key</label>
              <input id="sessionKey" name="sessionKey" type="text" inputmode="numeric" autocomplete="one-time-code" placeholder="1234-5678-ABCD" maxlength="20" />
            </div>
            <div class="actions">
              <button id="startSession">Start Session</button>
              <span id="sessionLoading" class="loading" aria-live="polite">Validating…</span>
            </div>
          </div>
        </article>

      </section>
    </main>

    <footer>
      <small>© <span id="y"></span> rsm.support. All rights reserved.</small>
    </footer>

    <script>
      // --- Utilities ---------------------------------------------------------
      const $$ = (sel, ctx=document) => ctx.querySelector(sel);
      const show = (el, on=true, cls='show') => el?.classList[on ? 'add' : 'remove'](cls);
      const sleep = (ms) => new Promise(r => setTimeout(r, ms));

      // --- Similar-but-not-identical to source JS behaviors -----------------
      // 1) Popup helper (inspired by window.open usage), but with centering & focus
      function openCenteredPopup(url, { name = 'help_popup', width = 420, height = 340, features = '' } = {}) {
        const dualScreenLeft = window.screenLeft !== undefined ? window.screenLeft : window.screenX;
        const dualScreenTop = window.screenTop !== undefined ? window.screenTop : window.screenY;
        const w = window.innerWidth || document.documentElement.clientWidth || screen.width;
        const h = window.innerHeight || document.documentElement.clientHeight || screen.height;
        const left = Math.max(0, (w - width) / 2 + dualScreenLeft);
        const top = Math.max(0, (h - height) / 2 + dualScreenTop);
        const opts = `scrollbars=yes,resizable=yes,width=${width},height=${height},top=${top},left=${left}${features ? ','+features : ''}`;
        const win = window.open(url, name, opts);
        try { win?.focus(); } catch {}
        return win;
      }

      // 2) Session key validation (client-side format check + mock server call)
      function validateSessionKeyFormat(key) {
        // Permit digits, letters, dashes; must be 8–20 chars, at least 6 digits.
        const okChars = /^[A-Za-z0-9-]{8,20}$/; if (!okChars.test(key)) return false;
        const digits = (key.match(/[0-9]/g) || []).length; return digits >= 6;
      }

      async function submitSessionKey(key) {
        const err = $$('#sessionKeyError'), spinner = $$('#sessionLoading');
        err.textContent = '';
        show(err, false);
        show(spinner, true);
        await sleep(700); // simulate latency
        // Replace with your real endpoint, e.g., fetch('/api/start-session', { method: 'POST', body: JSON.stringify({ key }) })
        const accepted = key.toUpperCase().endsWith('OK'); // mock rule for demo
        show(spinner, false);
        if (!accepted) {
          // Random error messages for valid session keys
          const errorMessages = [
            'The session key you entered is invalid or expired.',
            'The session key you entered is definitely invalid.',
            'Please check your hearing.'
          ];
          const randomIndex = Math.floor(Math.random() * errorMessages.length);
          err.textContent = errorMessages[randomIndex];
          show(err, true);
          return false;
        }
        // Redirect to your session launcher page
        window.location.assign(`/support/session/start?key=${encodeURIComponent(key)}`);
        return true;
      }


      // 4) Minimal analytics wrapper (replaces old ga.js approach)
      function trackEvent(category, action, label) {
        // Replace with your analytics SDK or sendBeacon endpoint
        try {
          navigator.sendBeacon?.('/analytics/event', new Blob([JSON.stringify({
            t: Date.now(), category, action, label, ua: navigator.userAgent
          })], { type: 'application/json' }));
        } catch {}
      }

      // --- Wire up UI --------------------------------------------------------
      document.addEventListener('DOMContentLoaded', () => {
        $$('#y').textContent = new Date().getFullYear();

        $$('#openHelp')?.addEventListener('click', () => {
          openCenteredPopup('/help/session-key', { width: 520, height: 420, name: 'help' });
          trackEvent('help', 'open', 'session-key');
        });

        $$('#startSession')?.addEventListener('click', async () => {
          const key = $$('#sessionKey').value.trim();
          if (!validateSessionKeyFormat(key)) {
            const err = $$('#sessionKeyError');
            err.textContent = 'Please enter a valid session key (8–20 chars, letters/digits/dashes).';
            show(err, true);
            return;
          }
          await submitSessionKey(key);
        });

      });
    </script>
  </body>
</html>
